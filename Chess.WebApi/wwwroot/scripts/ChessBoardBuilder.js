import { DomManipulator } from './DomManipulator.js';
import { RequestCallbacksDto } from './Dtos/RequestCallbacksDto.js';
import { RequestSender } from './RequestSender.js';
import { Square } from './Square.js';
var a = 'A';
var h = 'H';
var table = 'table';
var th = 'th';
var tr = 'tr';
var td = 'td';
var tc = 'tc';
var id = 'id';
var selected = 'selected';
var InitialState = [
    ['♜', '♞', '♝', '♛', '♚', '♝', '♞', '♜'],
    ['♟', '♟', '♟', '♟', '♟', '♟', '♟', '♟'],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    ['♙', '♙', '♙', '♙', '♙', '♙', '♙', '♙'],
    ['♖', '♘', '♗', '♕', '♔', '♗', '♘', '♖']
];
var State = [
    ['♜', '♞', '♝', '♛', '♚', '♝', '♞', '♜'],
    ['♟', '♟', '♟', '♟', '♟', '♟', '♟', '♟'],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    ['♙', '♙', '♙', '♙', '♙', '♙', '♙', '♙'],
    ['♖', '♘', '♗', '♕', '♔', '♗', '♘', '♖']
];
var ChessBoardBuilder = /** @class */ (function () {
    function ChessBoardBuilder() {
        this.domManipulator = new DomManipulator();
        this.moveFrom = null;
        this.whiteOnTopWhenShow = false;
        this.showChessBoard();
    }
    ChessBoardBuilder.prototype.createChessBoard = function () {
        var body = document.getElementsByTagName('body')[0];
        var board = this.domManipulator.createElement(table, body);
        board === null || board === void 0 ? void 0 : board.setAttribute('class', 'chess-board');
        var tableBody = this.domManipulator.createElement('tbody', board);
        this.createTableColumns(tableBody);
        this.createSquares(tableBody);
    };
    ChessBoardBuilder.prototype.createTableColumns = function (tableBody) {
        var header = this.domManipulator.createElement(tr, tableBody);
        this.domManipulator.createElement(th, header);
        for (var columnIndex = 0; columnIndex < 8; columnIndex++) {
            this.createTableHeaderCell(header, tc + columnIndex + 1, this.getColumnText(columnIndex));
        }
    };
    ChessBoardBuilder.prototype.createTableHeaderCell = function (parent, idValue, text) {
        var header = this.domManipulator.createElement(th, parent);
        header.setAttribute(id, idValue);
        header.textContent = text;
    };
    ChessBoardBuilder.prototype.createTableRank = function (tableBody, rankNumber) {
        var rank = this.domManipulator.createElement(tr, tableBody);
        this.createTableHeaderCell(rank, tr + rankNumber, rankNumber.toString());
        return rank;
    };
    ChessBoardBuilder.prototype.createSquares = function (tableBody) {
        for (var rankIndex = 0; rankIndex < 8; rankIndex++) {
            var rankNumber = this.whiteOnTopWhenShow ? rankIndex + 1 : 8 - rankIndex;
            var rank = this.createTableRank(tableBody, rankNumber);
            for (var columnIndex = 0; columnIndex < 8; columnIndex++) {
                var square = this.domManipulator.createElement(td, rank);
                square.setAttribute(id, this.getColumnText(columnIndex) + rankNumber);
                square.onclick = this.squareOnClick.bind(this);
                square.setAttribute('class', (rankIndex + columnIndex) % 2 == 1 ? 'dark' : 'light');
                square.textContent = this.isWhiteOnTopInStateRepresentation() ?
                    this.getState(rankNumber - 1, this.whiteOnTopWhenShow ? columnIndex : 7 - columnIndex) :
                    this.getState(this.whiteOnTopWhenShow ? 7 - rankIndex : rankIndex, this.whiteOnTopWhenShow ? 7 - columnIndex : columnIndex);
            }
        }
    };
    ChessBoardBuilder.prototype.squareOnClick = function (event) {
        if (this.moveFrom == null) {
            this.moveFrom = event.srcElement;
            this.moveFrom.classList.add(selected);
        }
        else {
            this.moveFrom.classList.remove(selected);
            var toSquare = this.getSquare(event.srcElement);
            var fromSquare = this.getSquare(this.moveFrom);
            this.move(this.getMove(fromSquare, toSquare));
            this.moveFrom = null;
        }
    };
    ChessBoardBuilder.prototype.move = function (move) {
        var _this = this;
        RequestSender.execute("KnightsTale/api/game/move/".concat(move), 'POST', new RequestCallbacksDto(function (knightsTaleDto) {
            _this.loadState(knightsTaleDto);
        }, function (request) { RequestSender.showError(request); }), "".concat(move, " executed."));
    };
    ChessBoardBuilder.prototype.getMove = function (fromSquare, toSquare) {
        return fromSquare.toString(this.whiteOnTopWhenShow) + toSquare.toString(this.whiteOnTopWhenShow);
    };
    ChessBoardBuilder.prototype.getSquare = function (square) {
        var rank = parseInt(square.id[1]);
        var column = square.id.charCodeAt(0);
        return this.isWhiteOnTopInStateRepresentation() ?
            new Square(h.charCodeAt(0) - column, rank - 1) :
            new Square(column - a.charCodeAt(0), 8 - rank);
    };
    ChessBoardBuilder.prototype.charShift = function (ch, shift) {
        return String.fromCharCode(ch.charCodeAt(0) + shift);
    };
    ChessBoardBuilder.prototype.getColumnText = function (columnIndex) {
        return this.whiteOnTopWhenShow ? this.charShift(h, -columnIndex) : this.charShift(a, columnIndex);
    };
    ChessBoardBuilder.prototype.isWhiteOnTopInStateRepresentation = function () {
        return InitialState[0][0] == '♖';
    };
    ChessBoardBuilder.prototype.getState = function (rankIndex, columnIndex) {
        return State[rankIndex][columnIndex];
    };
    ChessBoardBuilder.prototype.setState = function (rankIndex, columnIndex, value) {
        State[rankIndex][columnIndex] = value;
    };
    ChessBoardBuilder.prototype.resetStates = function () {
        for (var rankIndex = 0; rankIndex < 8; rankIndex++) {
            State[rankIndex] = InitialState[rankIndex].map(function (x) { return x; });
        }
    };
    ChessBoardBuilder.prototype.showChessBoard = function (whiteOnTopWhenShow) {
        if (whiteOnTopWhenShow === void 0) { whiteOnTopWhenShow = undefined; }
        if (whiteOnTopWhenShow !== undefined) {
            this.whiteOnTopWhenShow = whiteOnTopWhenShow;
        }
        var board = document.getElementsByTagName(table)[0];
        if (board) {
            board.remove();
            this.moveFrom = null;
        }
        this.createChessBoard();
    };
    ChessBoardBuilder.prototype.switchSide = function () {
        this.showChessBoard(!this.whiteOnTopWhenShow);
    };
    ChessBoardBuilder.prototype.loadState = function (knightsTaleDto) {
        for (var i = 0; i < knightsTaleDto.states.length; i++) {
            var rank = Math.floor(i / 8);
            var column = i % 8;
            this.setState(rank, column, knightsTaleDto.states[i]);
        }
        this.showChessBoard();
    };
    return ChessBoardBuilder;
}());
export { ChessBoardBuilder };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2hlc3NCb2FyZEJ1aWxkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJDaGVzc0JvYXJkQnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFckQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFckMsSUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDO0FBQ2QsSUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDO0FBQ2QsSUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDO0FBQ3RCLElBQU0sRUFBRSxHQUFHLElBQUksQ0FBQztBQUNoQixJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUM7QUFDaEIsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDO0FBQ2hCLElBQU0sRUFBRSxHQUFHLElBQUksQ0FBQztBQUNoQixJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUM7QUFDaEIsSUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDO0FBRTVCLElBQU0sWUFBWSxHQUF5QjtJQUMxQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDeEMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ3hDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUN4QyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDeEMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ3hDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUN4QyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDeEMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0NBQ3hDLENBQUM7QUFFRixJQUFNLEtBQUssR0FBeUI7SUFDbkMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ3hDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUN4QyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDeEMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ3hDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FB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O0lBQy9DLENBQUM7SUFFTSxxQ0FBUyxHQUFoQixVQUFpQixjQUE4QjtRQUM5QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDdEQsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0IsSUFBTSxNQUFNLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQVUsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzlEO1FBQ0QsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFDTCx3QkFBQztBQUFELENBQUMsQUEvSUQsSUErSUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEb21NYW5pcHVsYXRvciB9IGZyb20gJy4vRG9tTWFuaXB1bGF0b3IuanMnO1xyXG5pbXBvcnQgdHlwZSB7IEtuaWdodHNUYWxlRHRvIH0gZnJvbSAnLi9EdG9zL0tuaWdodHNUYWxlRHRvLmpzJztcclxuaW1wb3J0IHsgUmVxdWVzdENhbGxiYWNrc0R0byB9IGZyb20gJy4vRHRvcy9SZXF1ZXN0Q2FsbGJhY2tzRHRvLmpzJztcclxuaW1wb3J0IHsgUmVxdWVzdFNlbmRlciB9IGZyb20gJy4vUmVxdWVzdFNlbmRlci5qcyc7XHJcbmltcG9ydCB7IFNxdWFyZSB9IGZyb20gJy4vU3F1YXJlLmpzJztcclxuXHJcbmNvbnN0IGEgPSAnQSc7XHJcbmNvbnN0IGggPSAnSCc7XHJcbmNvbnN0IHRhYmxlID0gJ3RhYmxlJztcclxuY29uc3QgdGggPSAndGgnO1xyXG5jb25zdCB0ciA9ICd0cic7XHJcbmNvbnN0IHRkID0gJ3RkJztcclxuY29uc3QgdGMgPSAndGMnO1xyXG5jb25zdCBpZCA9ICdpZCc7XHJcbmNvbnN0IHNlbGVjdGVkID0gJ3NlbGVjdGVkJztcclxuXHJcbmNvbnN0IEluaXRpYWxTdGF0ZTogQXJyYXk8QXJyYXk8c3RyaW5nPj4gPSBbXHJcblx0WyfimZwnLCAn4pmeJywgJ+KZnScsICfimZsnLCAn4pmaJywgJ+KZnScsICfimZ4nLCAn4pmcJ10sXHJcblx0WyfimZ8nLCAn4pmfJywgJ+KZnycsICfimZ8nLCAn4pmfJywgJ+KZnycsICfimZ8nLCAn4pmfJ10sXHJcblx0WycgJywgJyAnLCAnICcsICcgJywgJyAnLCAnICcsICcgJywgJyAnXSxcclxuXHRbJyAnLCAnICcsICcgJywgJyAnLCAnICcsICcgJywgJyAnLCAnICddLFxyXG5cdFsnICcsICcgJywgJyAnLCAnICcsICcgJywgJyAnLCAnICcsICcgJ10sXHJcblx0WycgJywgJyAnLCAnICcsICcgJywgJyAnLCAnICcsICcgJywgJyAnXSxcclxuXHRbJ+KZmScsICfimZknLCAn4pmZJywgJ+KZmScsICfimZknLCAn4pmZJywgJ+KZmScsICfimZknXSxcclxuXHRbJ+KZlicsICfimZgnLCAn4pmXJywgJ+KZlScsICfimZQnLCAn4pmXJywgJ+KZmCcsICfimZYnXVxyXG5dO1xyXG5cclxuY29uc3QgU3RhdGU6IEFycmF5PEFycmF5PHN0cmluZz4+ID0gW1xyXG5cdFsn4pmcJywgJ+KZnicsICfimZ0nLCAn4pmbJywgJ+KZmicsICfimZ0nLCAn4pmeJywgJ+KZnCddLFxyXG5cdFsn4pmfJywgJ+KZnycsICfimZ8nLCAn4pmfJywgJ+KZnycsICfimZ8nLCAn4pmfJywgJ+KZnyddLFxyXG5cdFsnICcsICcgJywgJyAnLCAnICcsICcgJywgJyAnLCAnICcsICcgJ10sXHJcblx0WycgJywgJyAnLCAnICcsICcgJywgJyAnLCAnICcsICcgJywgJyAnXSxcclxuXHRbJyAnLCAnICcsICcgJywgJyAnLCAnICcsICcgJywgJyAnLCAnICddLFxyXG5cdFsnICcsICcgJywgJyAnLCAnICcsICcgJywgJyAnLCAnICcsICcgJ10sXHJcblx0WyfimZknLCAn4pmZJywgJ+KZmScsICfimZknLCAn4pmZJywgJ+KZmScsICfimZknLCAn4pmZJ10sXHJcblx0WyfimZYnLCAn4pmYJywgJ+KZlycsICfimZUnLCAn4pmUJywgJ+KZlycsICfimZgnLCAn4pmWJ11cclxuXTtcclxuXHJcbmV4cG9ydCBjbGFzcyBDaGVzc0JvYXJkQnVpbGRlciB7XHJcblxyXG5cdHByaXZhdGUgZG9tTWFuaXB1bGF0b3I6IERvbU1hbmlwdWxhdG9yO1xyXG5cdHByaXZhdGUgbW92ZUZyb206IEhUTUxFbGVtZW50IHwgbnVsbDtcclxuXHRwcml2YXRlIHdoaXRlT25Ub3BXaGVuU2hvdzogYm9vbGVhbjtcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0dGhpcy5kb21NYW5pcHVsYXRvciA9IG5ldyBEb21NYW5pcHVsYXRvcigpO1xyXG5cdFx0dGhpcy5tb3ZlRnJvbSA9IG51bGw7XHJcblx0XHR0aGlzLndoaXRlT25Ub3BXaGVuU2hvdyA9IGZhbHNlO1xyXG5cdFx0dGhpcy5zaG93Q2hlc3NCb2FyZCgpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBjcmVhdGVDaGVzc0JvYXJkKCk6IHZvaWQge1xyXG5cdFx0Y29uc3QgYm9keTogSFRNTEJvZHlFbGVtZW50IHwgdW5kZWZpbmVkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTtcclxuXHRcdGNvbnN0IGJvYXJkOiBIVE1MVGFibGVFbGVtZW50IHwgdW5kZWZpbmVkID0gPEhUTUxUYWJsZUVsZW1lbnQgfCB1bmRlZmluZWQ+dGhpcy5kb21NYW5pcHVsYXRvci5jcmVhdGVFbGVtZW50KHRhYmxlLCA8SFRNTEVsZW1lbnQ+Ym9keSk7XHJcblx0XHRib2FyZD8uc2V0QXR0cmlidXRlKCdjbGFzcycsICdjaGVzcy1ib2FyZCcpO1xyXG5cdFx0Y29uc3QgdGFibGVCb2R5OiBIVE1MRWxlbWVudCA9IHRoaXMuZG9tTWFuaXB1bGF0b3IuY3JlYXRlRWxlbWVudCgndGJvZHknLCA8SFRNTEVsZW1lbnQ+Ym9hcmQpO1xyXG5cclxuXHRcdHRoaXMuY3JlYXRlVGFibGVDb2x1bW5zKHRhYmxlQm9keSk7XHJcblx0XHR0aGlzLmNyZWF0ZVNxdWFyZXModGFibGVCb2R5KTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgY3JlYXRlVGFibGVDb2x1bW5zKHRhYmxlQm9keTogSFRNTEVsZW1lbnQpOiB2b2lkIHtcclxuXHRcdGNvbnN0IGhlYWRlcjogSFRNTEVsZW1lbnQgPSB0aGlzLmRvbU1hbmlwdWxhdG9yLmNyZWF0ZUVsZW1lbnQodHIsIHRhYmxlQm9keSk7XHJcblx0XHR0aGlzLmRvbU1hbmlwdWxhdG9yLmNyZWF0ZUVsZW1lbnQodGgsIGhlYWRlcik7XHRcclxuXHRcdGZvciAobGV0IGNvbHVtbkluZGV4ID0gMDsgY29sdW1uSW5kZXggPCA4OyBjb2x1bW5JbmRleCsrKSB7XHJcblx0XHRcdHRoaXMuY3JlYXRlVGFibGVIZWFkZXJDZWxsKGhlYWRlciwgdGMgKyBjb2x1bW5JbmRleCArIDEsIHRoaXMuZ2V0Q29sdW1uVGV4dChjb2x1bW5JbmRleCkpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBjcmVhdGVUYWJsZUhlYWRlckNlbGwocGFyZW50OiBIVE1MRWxlbWVudCwgaWRWYWx1ZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcclxuXHRcdGNvbnN0IGhlYWRlciA9IHRoaXMuZG9tTWFuaXB1bGF0b3IuY3JlYXRlRWxlbWVudCh0aCwgcGFyZW50KTtcclxuXHRcdGhlYWRlci5zZXRBdHRyaWJ1dGUoaWQsIGlkVmFsdWUpO1xyXG5cdFx0aGVhZGVyLnRleHRDb250ZW50ID0gdGV4dDtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgY3JlYXRlVGFibGVSYW5rKHRhYmxlQm9keTogSFRNTEVsZW1lbnQsIHJhbmtOdW1iZXI6IG51bWJlcikge1xyXG5cdFx0Y29uc3QgcmFuayA9IHRoaXMuZG9tTWFuaXB1bGF0b3IuY3JlYXRlRWxlbWVudCh0ciwgdGFibGVCb2R5KTtcclxuXHRcdHRoaXMuY3JlYXRlVGFibGVIZWFkZXJDZWxsKHJhbmssIHRyICsgcmFua051bWJlciwgcmFua051bWJlci50b1N0cmluZygpKTtcclxuXHRcdHJldHVybiByYW5rO1xyXG5cdH1cclxuXHRcclxuXHRwcml2YXRlIGNyZWF0ZVNxdWFyZXModGFibGVCb2R5OiBIVE1MRWxlbWVudCkge1xyXG5cdFx0Zm9yIChsZXQgcmFua0luZGV4ID0gMDsgcmFua0luZGV4IDwgODsgcmFua0luZGV4KyspIHtcclxuXHRcdFx0Y29uc3QgcmFua051bWJlcjogbnVtYmVyID0gdGhpcy53aGl0ZU9uVG9wV2hlblNob3cgPyByYW5rSW5kZXggKyAxIDogOCAtIHJhbmtJbmRleDtcclxuXHRcdFx0Y29uc3QgcmFuayA9IHRoaXMuY3JlYXRlVGFibGVSYW5rKHRhYmxlQm9keSwgcmFua051bWJlcik7XHJcblx0XHRcdFxyXG5cdFx0XHRmb3IgKGxldCBjb2x1bW5JbmRleCA9IDA7IGNvbHVtbkluZGV4IDwgODsgY29sdW1uSW5kZXgrKykge1xyXG5cdFx0XHRcdGNvbnN0IHNxdWFyZSA9IHRoaXMuZG9tTWFuaXB1bGF0b3IuY3JlYXRlRWxlbWVudCh0ZCwgcmFuayk7XHJcblx0XHRcdFx0c3F1YXJlLnNldEF0dHJpYnV0ZShpZCwgdGhpcy5nZXRDb2x1bW5UZXh0KGNvbHVtbkluZGV4KSArIHJhbmtOdW1iZXIpO1xyXG5cdFx0XHRcdHNxdWFyZS5vbmNsaWNrID0gdGhpcy5zcXVhcmVPbkNsaWNrLmJpbmQodGhpcyk7XHJcblx0XHRcdFx0c3F1YXJlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAocmFua0luZGV4ICsgY29sdW1uSW5kZXgpICUgMiA9PSAxID8gJ2RhcmsnIDogJ2xpZ2h0Jyk7XHJcblx0XHRcdFx0c3F1YXJlLnRleHRDb250ZW50ID0gdGhpcy5pc1doaXRlT25Ub3BJblN0YXRlUmVwcmVzZW50YXRpb24oKSA/XHJcblx0XHRcdFx0XHR0aGlzLmdldFN0YXRlKHJhbmtOdW1iZXIgLSAxLCB0aGlzLndoaXRlT25Ub3BXaGVuU2hvdyA/IGNvbHVtbkluZGV4IDogNyAtIGNvbHVtbkluZGV4KSA6XHJcblx0XHRcdFx0XHR0aGlzLmdldFN0YXRlKHRoaXMud2hpdGVPblRvcFdoZW5TaG93ID8gNyAtIHJhbmtJbmRleCA6IHJhbmtJbmRleCwgdGhpcy53aGl0ZU9uVG9wV2hlblNob3cgPyA3IC0gY29sdW1uSW5kZXggOiBjb2x1bW5JbmRleCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHByaXZhdGUgc3F1YXJlT25DbGljayhldmVudDogTW91c2VFdmVudCkge1xyXG5cdFx0aWYgKHRoaXMubW92ZUZyb20gPT0gbnVsbCkge1xyXG5cdFx0XHR0aGlzLm1vdmVGcm9tID0gPEhUTUxFbGVtZW50PmV2ZW50LnNyY0VsZW1lbnQ7XHJcblx0XHRcdHRoaXMubW92ZUZyb20uY2xhc3NMaXN0LmFkZChzZWxlY3RlZCk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLm1vdmVGcm9tLmNsYXNzTGlzdC5yZW1vdmUoc2VsZWN0ZWQpO1xyXG5cdFx0XHRjb25zdCB0b1NxdWFyZTogU3F1YXJlID0gdGhpcy5nZXRTcXVhcmUoPEhUTUxFbGVtZW50PmV2ZW50LnNyY0VsZW1lbnQpO1xyXG5cdFx0XHRjb25zdCBmcm9tU3F1YXJlOiBTcXVhcmUgPSB0aGlzLmdldFNxdWFyZSh0aGlzLm1vdmVGcm9tKTtcclxuXHRcdFx0dGhpcy5tb3ZlKHRoaXMuZ2V0TW92ZShmcm9tU3F1YXJlLCB0b1NxdWFyZSkpO1xyXG5cdFx0XHR0aGlzLm1vdmVGcm9tID0gbnVsbDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyBtb3ZlKG1vdmU6IHN0cmluZyk6IHZvaWQge1xyXG5cdFx0UmVxdWVzdFNlbmRlci5leGVjdXRlKGBLbmlnaHRzVGFsZS9hcGkvZ2FtZS9tb3ZlLyR7bW92ZX1gLCAnUE9TVCcsXHJcblx0XHRcdG5ldyBSZXF1ZXN0Q2FsbGJhY2tzRHRvKChrbmlnaHRzVGFsZUR0bzogS25pZ2h0c1RhbGVEdG8pID0+IHtcclxuXHRcdFx0XHR0aGlzLmxvYWRTdGF0ZShrbmlnaHRzVGFsZUR0byk7XHJcblx0XHRcdH0sIChyZXF1ZXN0OiBKUXVlcnkuanFYSFI8b2JqZWN0PikgPT4geyBSZXF1ZXN0U2VuZGVyLnNob3dFcnJvcihyZXF1ZXN0KTsgfSksIGAke21vdmV9IGV4ZWN1dGVkLmApO1xyXG4gICAgfVxyXG5cclxuXHRwcml2YXRlIGdldE1vdmUoZnJvbVNxdWFyZTogU3F1YXJlLCB0b1NxdWFyZTogU3F1YXJlKTogc3RyaW5nIHtcclxuXHRcdHJldHVybiBmcm9tU3F1YXJlLnRvU3RyaW5nKHRoaXMud2hpdGVPblRvcFdoZW5TaG93KSArIHRvU3F1YXJlLnRvU3RyaW5nKHRoaXMud2hpdGVPblRvcFdoZW5TaG93KTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgZ2V0U3F1YXJlKHNxdWFyZTogSFRNTEVsZW1lbnQpOiBTcXVhcmUge1xyXG5cdFx0Y29uc3QgcmFuayA9IHBhcnNlSW50KDxzdHJpbmc+c3F1YXJlLmlkWzFdKTtcclxuXHRcdGNvbnN0IGNvbHVtbiA9IHNxdWFyZSAuaWQuY2hhckNvZGVBdCgwKTtcclxuXHRcdHJldHVybiB0aGlzLmlzV2hpdGVPblRvcEluU3RhdGVSZXByZXNlbnRhdGlvbigpID9cclxuXHRcdFx0bmV3IFNxdWFyZShoLmNoYXJDb2RlQXQoMCkgLSBjb2x1bW4sIHJhbmsgLSAxKSA6XHJcblx0XHRcdG5ldyBTcXVhcmUoY29sdW1uIC0gYS5jaGFyQ29kZUF0KDApLCA4IC0gcmFuayk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGNoYXJTaGlmdChjaDogc3RyaW5nLCBzaGlmdDogbnVtYmVyKTogc3RyaW5nIHtcclxuXHRcdHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoLmNoYXJDb2RlQXQoMCkgKyBzaGlmdCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGdldENvbHVtblRleHQoY29sdW1uSW5kZXg6IG51bWJlcik6IHN0cmluZyB7XHJcblx0XHRyZXR1cm4gdGhpcy53aGl0ZU9uVG9wV2hlblNob3cgPyB0aGlzLmNoYXJTaGlmdChoLCAtY29sdW1uSW5kZXgpIDogdGhpcy5jaGFyU2hpZnQoYSwgY29sdW1uSW5kZXgpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBpc1doaXRlT25Ub3BJblN0YXRlUmVwcmVzZW50YXRpb24oKTogYm9vbGVhbiB7XHJcblx0XHRyZXR1cm4gKDxBcnJheTxzdHJpbmc+PkluaXRpYWxTdGF0ZVswXSlbMF0gPT0gJ+KZlic7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGdldFN0YXRlKHJhbmtJbmRleDogbnVtYmVyLCBjb2x1bW5JbmRleDogbnVtYmVyKTogc3RyaW5nIHtcclxuXHRcdHJldHVybiA8c3RyaW5nPig8QXJyYXk8c3RyaW5nPj5TdGF0ZVtyYW5rSW5kZXhdKVtjb2x1bW5JbmRleF07XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHNldFN0YXRlKHJhbmtJbmRleDogbnVtYmVyLCBjb2x1bW5JbmRleDogbnVtYmVyLCB2YWx1ZTogc3RyaW5nKTogdm9pZCB7XHJcblx0XHQoPEFycmF5PHN0cmluZz4+U3RhdGVbcmFua0luZGV4XSlbY29sdW1uSW5kZXhdID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmVzZXRTdGF0ZXMoKTogdm9pZCB7XHJcblx0XHRmb3IgKGxldCByYW5rSW5kZXggPSAwOyByYW5rSW5kZXggPCA4OyByYW5rSW5kZXgrKykge1xyXG5cdFx0XHRTdGF0ZVtyYW5rSW5kZXhdID0gKDxBcnJheTxzdHJpbmc+PkluaXRpYWxTdGF0ZVtyYW5rSW5kZXhdKS5tYXAoKHg6IHN0cmluZykgPT4geCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2hvd0NoZXNzQm9hcmQod2hpdGVPblRvcFdoZW5TaG93OiBib29sZWFuIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkKTogdm9pZCB7XHJcblx0XHRpZiAod2hpdGVPblRvcFdoZW5TaG93ICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dGhpcy53aGl0ZU9uVG9wV2hlblNob3cgPSB3aGl0ZU9uVG9wV2hlblNob3c7XHJcbiAgICAgICAgfVxyXG5cclxuXHRcdGNvbnN0IGJvYXJkOiBIVE1MVGFibGVFbGVtZW50IHwgdW5kZWZpbmVkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFibGUpWzBdO1xyXG5cdFx0aWYgKGJvYXJkKSB7XHJcblx0XHRcdGJvYXJkLnJlbW92ZSgpO1xyXG5cdFx0XHR0aGlzLm1vdmVGcm9tID0gbnVsbDtcclxuXHRcdH1cclxuXHRcdHRoaXMuY3JlYXRlQ2hlc3NCb2FyZCgpO1xyXG5cdH1cclxuXHRcclxuXHRwdWJsaWMgc3dpdGNoU2lkZSgpOiB2b2lkIHtcclxuXHRcdHRoaXMuc2hvd0NoZXNzQm9hcmQoIXRoaXMud2hpdGVPblRvcFdoZW5TaG93KTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBsb2FkU3RhdGUoa25pZ2h0c1RhbGVEdG86IEtuaWdodHNUYWxlRHRvKTogdm9pZCB7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGtuaWdodHNUYWxlRHRvLnN0YXRlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRjb25zdCByYW5rID0gTWF0aC5mbG9vcihpIC8gOCk7XHJcblx0XHRcdGNvbnN0IGNvbHVtbiA9IGkgJSA4O1xyXG5cdFx0XHR0aGlzLnNldFN0YXRlKHJhbmssIGNvbHVtbiwgPHN0cmluZz5rbmlnaHRzVGFsZUR0by5zdGF0ZXNbaV0pO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5zaG93Q2hlc3NCb2FyZCgpO1xyXG4gICAgfVxyXG59Il19